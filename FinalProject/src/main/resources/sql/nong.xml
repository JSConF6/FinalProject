<?xml version="1.0" encoding="UTF-8" ?>
<!-- SQL맵퍼 파일은 xml이기 때문에 제일 먼저 xml 선언이 옵니다. -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Nongs">

<select id="count" resultType="int">
 select count(*) from nong 
 where name = #{name}
</select>

<select id="list" parameterType="java.util.Map" resultType="nong" >
 select * from 
 (select rownum rnum, b.*
  from 
        (select nong.*, nvl(cnt,0) cnt
         from 
         nong left outer join (select nong_num, count(*) cnt
                                from NONG_CO
                                group by nong_num) c
         on nong.nong_num = c.nong_num
	     order by NONG_RE_REF desc,
	     NONG_RE_SEQ asc) b
 )
where rnum &gt;= #{start} and rnum &lt;= #{end} and name = #{name}
</select>

<insert id="insert" parameterType="nong">
    <selectKey resultType="int"      order="BEFORE"
               keyProperty="nong_num">
         select nvl(max(NONG_NUM),0)+1 from nong     
    </selectKey>
    insert into nong
    (NONG_NUM,
     NAME, ID, NONG_PASS, NONG_SUB,
     NONG_CON, NONG_FILE, NONG_ORI, 
     NONG_RE_REF, 
     NONG_RE_LEV, NONG_RE_SEQ, NONG_READ,
     NONG_DATE)
     values
     (#{nong_num},
      #{name}, #{id}, #{nong_pass}, #{nong_sub},
      #{nong_con}, #{nong_file, jdbcType=VARCHAR}, 
      #{nong_ori, jdbcType=VARCHAR},
      #{nong_num},
      #{nong_re_lev}, #{nong_re_seq}, #{nong_read},
      sysdate)
      
</insert>

<update id="readCountUpdate" parameterType="int">
   update nong
   set    NONG_READ = NONG_READ+1
   where  NONG_NUM = #{number}
</update>

<select id="detail" parameterType="int" resultType="nong">
   select *
   from   nong
   where  NONG_NUM = #{number}
</select>

</mapper>

